(()=>{"use strict";const e=window.wp.i18n,t=e=>"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e),r=window.wp.url,s=function(e,r){const s=`save-changes-${Date.now()}`,a=t("#spinner-save-changes");a.parentNode.insertAdjacentHTML("afterend",`<div id="${s}" class="ajax-alert notice notice-${e}"><p>${r}</p></div>`),a.remove();const o=t(`#${s}`);o.offsetWidth,o.style.opacity=0,o.addEventListener("transitionend",(()=>o.remove())),t(".button-save-changes").forEach((e=>e.disabled=!1)),document.body.classList.remove("wait")},a=t("#auto-export-active"),o=t("#auto-export-path"),n=t("#auto-export-csv-delimiter");t("#tablepress_auto_export_save_changes_button").addEventListener("click",(c=>{const i=a.checked,d=o.value.trim();if(i&&""===d)return window.alert((0,e.__)("You must set a server path for the automatic table export.","tablepress")),void o.focus();const l=[...document.querySelectorAll("#auto-export-formats input:checked")].map((e=>e.value));if(i&&0===l.length)return void window.alert((0,e.__)("You must select at least one export format for the automatic table export.","tablepress"));const u={active:i,path:d,formats:l,csv_delimiter:n.value};!function(a,o){a.target.parentNode.insertAdjacentHTML("beforeend",`<span id="spinner-save-changes" class="spinner-save-changes spinner is-active" title="${(0,e.__)("Changes are being saved â€¦","tablepress")}"/>`),t(".button-save-changes").forEach((e=>e.disabled=!0)),document.body.classList.add("wait"),fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:(0,r.buildQueryString)(o)}).then((e=>{if(!e.ok)throw new Error(`There was a problem with the server, HTTP response code ${e.status} (${e.statusText}).`);return e.json()})).then((t=>{if(null==t||"-1"===t||void 0===t.success)throw new Error("The JSON data returned from the server is unclear or incomplete.");if(!0!==t.success){const e=t.error_details?`</p><p>These errors were encountered:</p><pre>${t.error_details}</pre><p>`:"";throw new Error(`The data could not be saved to the database properly.${e}`)}!function(t){const r={success_save:(0,e.__)("The changes were saved successfully.","tablepress"),error_save:(0,e.__)("Attention: Unfortunately, an error occurred.","tablepress")},a=t.message.includes("error")?"error":"success";s(a,r[t.message])}(t)})).catch((t=>{return r=t.message,r=(0,e.__)("Attention: Unfortunately, an error occurred.","tablepress")+" "+r,void s("error",r);var r}))}(c,{action:"tablepress_export",_ajax_nonce:t("#_wpnonce").value,tablepress:JSON.stringify(u)})}));const c=()=>{const e=!a.checked;o.disabled=e,document.querySelectorAll("#auto-export-formats input").forEach((t=>t.disabled=e)),n.disabled=e};a.addEventListener("change",c),c();const i=t("#auto-export-format-csv"),d=()=>{n.disabled=!i.checked,t("#auto-export-csv-delimiter-description").style.display=i.checked?"none":"inline"};i.addEventListener("change",d),d()})();