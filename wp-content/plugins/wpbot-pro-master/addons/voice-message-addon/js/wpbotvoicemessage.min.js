"use strict";document.addEventListener("DOMContentLoaded",(function(){let e,t,n;URL=window.URL||window.webkitURL;let r,o,c,a,d,s,i,l,u=window.AudioContext||window.webkitAudioContext,p=!1,m=!1,f=document.getElementById("vmwbmdp-wpbotvoicemessage-fbutton");null!==f&&f.addEventListener("click",(function(){let e=document.getElementsByTagName("html")[0];document.querySelector(".vmwbmdp-wpbotvoicemessage-fbutton-overlay").style.display="block",e.classList.add("vmwbmdp-wpbotvoicemessage-modal-opened")}));let b=document.querySelector(".vmwbmdp-wpbotvoicemessage-fbutton-overlay");null!==b&&(b.addEventListener("click",L,!1),b.querySelectorAll(".vmwbmdp-wpbotvoicemessage-fbutton-modal .vmwbmdp-wpbotvoicemessage-close")[0].addEventListener("click",L,!1));let y=document.querySelector(".vmwbmdp-wpbotvoicemessage-fbutton-modal");null!==y&&y.addEventListener("click",e=>{e.stopPropagation()},!1);let g=document.querySelectorAll(".vmwbmdp-wpbotvoicemessage-form-box .vmwbmdp-wpbotvoicemessage-start-btn");for(const e of g){const t=e.parentNode.parentNode.parentNode;e.addEventListener("click",()=>{C(t)});t.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-reset-rec-btn").addEventListener("click",()=>{A(t)});t.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-stop-rec-btn").addEventListener("click",()=>{q(t)});t.querySelector(".vmwbmdp-send-btns .vmwbmdp-reset-rec-btn").addEventListener("click",()=>{k(t)});t.querySelector(".vmwbmdp-wpbotvoicemessage-thanks-box .vmwbmdp-restart").addEventListener("click",()=>{h(t)});t.querySelector(".vmwbmdp-send-btns .vmwbmdp-send-rec-btn").addEventListener("click",()=>{S(t)});t.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-reset-rec-yes").addEventListener("click",()=>{h(t)});t.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-reset-rec-no").addEventListener("click",e=>{w(e.target,t)}),i=t.querySelector(".vmwbmdp-wpbotvoicemessage-send-box form"),i&&i.addEventListener("submit",e=>{e.preventDefault()})}let v=document.querySelectorAll(".vmwbmdp-wpbotvoicemessage-form-box .vmwbmdp-mic-access-err-reload-btn");for(const e of v)e.addEventListener("click",()=>{location.reload()});function L(){let t=document.getElementsByTagName("html")[0],n=document.querySelector(".vmwbmdp-wpbotvoicemessage-fbutton-overlay");t.classList.add("vmwbmdp-wpbotvoicemessage-reverse"),setTimeout((function(){n.style.display="none",t.classList.remove("vmwbmdp-wpbotvoicemessage-modal-opened"),t.classList.remove("vmwbmdp-wpbotvoicemessage-reverse"),E(document.querySelector(".vmwbmdp-wpbotvoicemessage-fbutton-modal .vmwbmdp-wpbotvoicemessage-form-box")),void 0!==e&&e.getTracks().forEach((function(e){e.stop()}))}),600)}function w(e,n){"showSendStep"===e.getAttribute("show-step")?(x(n),e.setAttribute("show-step","")):(t.record(),R("Recording resumed."),p=!1,m=!1,c=window.requestAnimationFrame(a),F(n))}function h(n){t.stop(),e.getAudioTracks()[0].stop(),E(n)}function S(e){let t;!function(e){let t=e.querySelectorAll("#vmwbmdpCurrentURL")[0];if(void 0===t)return;t.value=window.location.href}(e),function(e){let t=e.querySelectorAll("#vmwbmdpUserDetails")[0];if(void 0===t)return;let n=e.querySelectorAll(".vmwbmdp-wpbotvoicemessage-additional-fields")[0].getAttribute("user-login"),r=e.querySelectorAll(".vmwbmdp-wpbotvoicemessage-additional-fields")[0].getAttribute("user-ip");n||(n="Guest");t.value=n+" ("+r+")"}(e),e.classList.add("vmwbmdp-busy");let n=e.querySelector(".vmwbmdp-wpbotvoicemessage-send-box form");if(n){if(!n.checkValidity())return n.reportValidity(),void e.classList.remove("vmwbmdp-busy");t=new FormData(n)}else t=new FormData;t.append("vmwbmdp-wpbotvoicemessage-audio",o),t.append("vmwbmdp-wpbotvoicemessage-audio-sample-rate",l),t.append("action","wpbotvoicemessage_send"),t.append("nonce",vmwbmdpContacterWP.nonce),t.append("cform-id",e.getAttribute("cform-id"));let r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&200===r.status&&(R(r.responseText),e.classList.remove("vmwbmdp-busy"),function(e){M(e),e.classList.add("vmwbmdp-step-thanks")}(e))},r.onload=function(){e.classList.remove("vmwbmdp-busy")},r.onerror=function(){e.classList.remove("vmwbmdp-busy"),R("Network Error.","error",!0),function(e){M(e),e.classList.add("vmwbmdp-step-error")}(e)},e.classList.add("vmwbmdp-busy"),r.open("POST",vmwbmdpContacterWP.ajaxurl,!0),r.send(t)}function k(e){e.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-reset-rec-no").setAttribute("show-step","showSendStep"),T(e)}function q(n){t.recording&&t.stop(),R("Recording stopped."),clearInterval(d),clearInterval(s),window.cancelAnimationFrame(c),x(n),function(e){const t=e.querySelector(".vmwbmdp-wpbotvoicemessage-send-box .vmwbmdp-wpbotvoicemessage-additional-fields");if(!t)return;let n=t.getAttribute("additional-fields");t.innerHTML=atobUTF8(n)}(n),e.getAudioTracks()[0].stop(),t.exportWAV(e=>{!function(e,t){let n=URL.createObjectURL(e);o=e;let r=document.createElement("audio");r.src=n;const c=t.querySelector(".vmwbmdp-wpbotvoicemessage-send-box .vmwbmdp-wpbotvoicemessage-player-box");c.innerHTML="",c.appendChild(r),new GreenAudioPlayer(c);let a=t.querySelector(".vmwbmdp-wpbotvoicemessage-download-link-box > a");null!==a&&(a.setAttribute("href",n),a.setAttribute("download","record.wav"))}(e,n)})}function A(e){t.recording&&t.stop(),R("Recording paused."),p=!0,m=!0,window.cancelAnimationFrame(c),T(e)}function C(o){!function(e){M(e),e.classList.add("vmwbmdp-step-allow-access")}(o),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){R("getUserMedia() success. Stream created. Initializing Recorder."),r=new u,l=r.sampleRate,R("Format: 1 channel pcm @ "+l/1e3+"kHz"),e=i,n=r.createMediaStreamSource(i),t=new Recorder(n,{numChannels:1}),t.record(),R("Recording started."),F(o),function(e){let t=0;const n=e.querySelector(".vmwbmdp-wpbotvoicemessage-recording-timer");if(null===n)return;let r=parseInt(e.getAttribute("max-duration"));clearInterval(d),p=!1,n.innerHTML="00:00",d=setInterval((function(){if(p)return;t++,0!==r&&t>r&&e.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-stop-rec-btn").click();let o=Math.floor(t/60),c=t-60*o;n.innerHTML=o.pad(2)+":"+c.pad(2)}),1e3)}(o),function(e){const t=e.querySelector(".vmwbmdp-wpbotvoicemessage-recording-countdown");if(null===t)return;let n=parseInt(e.getAttribute("max-duration"));if(0===n)return;let r=n;clearInterval(s),m=!1;let o=Math.floor(n/60),c=n-60*o;t.innerHTML=o.pad(2)+":"+c.pad(2),s=setInterval((function(){if(m)return;r--,0!==n&&r<0&&e.querySelector(".vmwbmdp-speak-now-btns .vmwbmdp-stop-rec-btn").click();let o=Math.floor(r/60),c=r-60*o;t.innerHTML=o.pad(2)+":"+c.pad(2)}),1e3)}(o),function(e){let t=r.createAnalyser();n.connect(t),t.fftSize=2048;let o=t.frequencyBinCount,d=new Uint8Array(o),s=e.querySelector(".vmwbmdp-wpbotvoicemessage-recording-animation canvas"),i=s.getContext("2d");i.clearRect(0,0,s.width,s.height),a=function(){c=requestAnimationFrame(a),t.getByteTimeDomainData(d),i.clearRect(0,0,s.width,s.height),i.fillStyle="rgba( 255, 255, 255, 0.01 )",i.fillRect(0,0,s.width,s.height),i.lineWidth=2;let e=vmwbmdpContacterWP.accentColor.replace(/[^,]+(?=\))/,"0"),n=vmwbmdpContacterWP.accentColor.replace(/[^,]+(?=\))/,"1");const r=i.createLinearGradient(0,0,384,0);r.addColorStop(0,e),r.addColorStop(.25,n),r.addColorStop(.75,n),r.addColorStop(1,e),i.strokeStyle=r,i.beginPath();let l=1*s.width/o,u=0;for(let e=0;e<o;e++){let t=d[e]/128*s.height/2;0===e?i.moveTo(u,t):i.lineTo(u,t),u+=l}i.lineTo(s.width,s.height/2),i.stroke()},a()}(o)})).catch((function(e){R("Error getUserMedia() fails. See details below.","warn",!0),R(e,"error",!0),function(e){M(e),e.classList.add("vmwbmdp-step-mic-access-err")}(o)}))}function x(e){M(e),e.classList.add("vmwbmdp-step-send")}function E(e){M(e),e.classList.add("vmwbmdp-step-start")}function T(e){M(e),e.classList.add("vmwbmdp-step-reset")}function F(e){M(e),e.classList.add("vmwbmdp-step-recording")}function M(e){e.classList.remove("vmwbmdp-step-start"),e.classList.remove("vmwbmdp-step-allow-access"),e.classList.remove("vmwbmdp-step-mic-access-err"),e.classList.remove("vmwbmdp-step-recording"),e.classList.remove("vmwbmdp-step-reset"),e.classList.remove("vmwbmdp-step-error"),e.classList.remove("vmwbmdp-step-send"),e.classList.remove("vmwbmdp-step-thanks")}function R(e,t="log",n=!1){let r=function(){let e={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,n,r){e[n]=r})),e}().debug;r=void 0!==r,n&&(r=!0),r&&(e="VoiceMessageAddon: "+e,"log"===t?console.log(e):"warn"===t?console.warn(e):"error"===t&&console.error(e))}Number.prototype.pad=function(e){let t=String(this);for(;t.length<(e||2);)t="0"+t;return t}})),function(e){var t=Math.log,n=Math.LN2,r=Math.clz32||function(e){return 31-t(e>>>0)/n|0},o=String.fromCharCode,c=atob,a=btoa;function d(e){var t=e.charCodeAt(0);if(t>=55296&&t<=56319){var n=e.charCodeAt(1);if(n!=n)return o(239,191,189);if(!(n>=56320&&n<=57343))return o(239,191,189);if((t=1024*(t-55296)+n-56320+65536)>65535)return o(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return t<=127?e:t<=2047?o(192|t>>>6,128|63&t):o(224|t>>>12,128|t>>>6&63,128|63&t)}function s(e){var t=e.charCodeAt(0)<<24,n=r(~t),c=0,a=e.length,d="";if(n<5&&a>=n){for(t=t<<n>>>24+n,c=1;c<n;++c)t=t<<6|63&e.charCodeAt(c);t<=65535?d+=o(t):t<=1114111?d+=o(55296+((t-=65536)>>10),56320+(1023&t)):c=0}for(;c<a;++c)d+="�";return d}e.btoaUTF8=function(e,t){return a((t?"ï»¿":"")+e.replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,d))},e.atobUTF8=function(e,t){return t||"ï»¿"!==e.substring(0,3)||(e=e.substring(3)),c(e).replace(/[\xc0-\xff][\x80-\xbf]*/g,s)}}(typeof global==""+void 0?typeof self==""+void 0?this:self:global);